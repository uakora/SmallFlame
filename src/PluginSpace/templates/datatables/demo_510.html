{% extends 'index.html' %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="/static/3rdLibs/bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/static/plugins/datatables-1.10.18/datatables.css">

    <link rel="stylesheet" type="text/css" href="/static/css/PluginSpace/datatables/common.css">

    <style>
        #example tbody tr td input {
            width: 100%;
        }
    </style>
{% endblock %}
{% block js %}
    <script src="/static/plugins/datatables-1.10.18/datatables.js"></script>
    <script src="/static/3rdLibs/bootstrap-3.3.7/js/bootstrap.js"></script>
{% endblock %}

{% block content %}
<div class="flame-container flame-body">
    <div class="left-column">
        {% block left_nav_bar %}
        {% include 'datatables_left_nav_bar.html' with active_idx=demo_idx %}
        {% endblock %}
    </div>
    <div class="center-column">
        {% block center_content %}
        <table id="example" class="table table-bordered" style="width: 100%;"></table>

        <section style="display: none">
        <div name="opt-btn">
            <button class="btn btn-xs btn-default btn-edit">编辑</button>
        </div>
        </section>
        {% endblock %}
    </div>
</div>
{% endblock %}

{% block custom_js %}
<script type="text/javascript">
"user strict"

$(document).ready(function () {
    var dt_table = $("#example").DataTable({
        'language': {
            'url': "/static/plugins/datatables-1.10.18/i18n/Chinese.lang"
        },
        "ajax": {
            url: "/plugins/datatables/data/mr/config/list",
            dataSrc: function (res) {

                res.data.forEach(function (item, idx) {
                    item['idx'] = idx
                });
                console.log(res.data);
                return res.data;
            }
        },
        "columns": [
            {"data": "idx", "title": "索引", "visible": false},
            {"data": "id", "title": "ID", "name": 'col-id', "visible": false},
            {"data": "old_vs", "title": "源版本", "name": 'col-old-vs'},
            {"data": "new_vs", "title": "新版本", "name": 'col-new-vs'},
            {"data": "branch", "title": "分支", "name": 'col-branch'},
            {"data": "node", "title": "节点", "name": 'col-node'},
            {
                "data": null,
                "title": "操作",
                "name": "col-opt"
            }
        ],
        "columnDefs": [
            {'targets': 0, 'orderable': true},
            {'targets': '_all', 'orderable': false},
            {
                'targets': 6,
                'createdCell': function (cell, cellData, rowData, rowIndex, colIndex ) {
                    var $dom = $('div[name="opt-btn"]').clone();
                    $(cell).html($dom[0].innerHTML);
                    if(rowIndex > 2) {
                        console.log("rowIndex: ", rowIndex);
                        $(cell).closest("tr").addClass("row-disable");
                    }

                    $(cell).on('click', 'button.btn-edit', function () {
                        var $row = $(cell).closest("tr");
                        $row.addClass("row-disable");
                        console.log("row: ", $row.find('td'));
                         $row.find('td').eq(0).html('<input type="text">');
                         $row.find('td').eq(1).html('<input type="text">');
                         $row.find('td').eq(2).html('<input type="text">');
                         $row.find('td').eq(3).html('<input type="text">');
                    });

                }
            }
        ],
        "rowReorder": {
            dataSrc: "idx",
            selector: "tr:not(.row-disable) td:not(:last-child)"
        }
    });

});

</script>
{% endblock %}

