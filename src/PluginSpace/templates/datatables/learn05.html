{% extends 'index.html' %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="/static/3rdLibs/bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/static/plugins/datatables-1.10.18/datatables.css">

    <link rel="stylesheet" type="text/css" href="/static/css/PluginSpace/datatables/common.css">
    <style>
        #mr_table tbody tr td{
            vertical-align: middle;
        }
        button.btn > i.fa{
            width: 12px;
        }
    </style>
{% endblock %}
{% block js %}
    <script src="/static/plugins/datatables-1.10.18/datatables.js"></script>
    <script src="/static/3rdLibs/bootstrap-3.3.7/js/bootstrap.js"></script>
{% endblock %}

{% block content %}
<div class="flame-container flame-body">
    <div class="left-column">
        {% block left_nav_bar %}
        {% include 'datatables_left_nav_bar.html' with active_idx=4  %}
        {% endblock %}
    </div>
    <div class="center-column">
        {% block center_content %}
        <div>
            <table id="mr_table" class="table table-striped" style="width: 100%;">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>Merge</th>
                        <th>提交人</th>
                        <th>MR时间</th>
                        <th>状态更新人</th>
                        <th>状态更新时间</th>
                        <th>状态</th>
                        <th>备注</th>
                        <th style="min-width: 72px;">操作</th>
                    </tr>
                </thead>
            </table>
        </div>
        <section style="display: none;">
            <div class="edit-button-box">
                <button class="btn btn-xs btn-default edit-button"><i class="fa fa-edit"></i></button>
            </div>
            <div class="update-button-box">
                <button class="btn btn-xs btn-success save-button" style="margin-right: 6px;"><i class="fa fa-check"></i></button>
                <button class="btn btn-xs btn-danger cancel-button"><i class="fa fa-times"></i></button>
            </div>
            <div class="mr-status-select">
                <select>
                    <option value="未确认">未确认</option>
                    <option value="已确认">已确认</option>
                    <option value="已合入">已合入</option>
                    <option value="未合入">未合入</option>
                    <option value="无需合入">无需合入</option>
                </select>
            </div>
        </section>
        {% endblock %}
    </div>
</div>
{% endblock %}

{% block custom_js %}
<script type="text/javascript">

$(document).ready(function () {
    var mr_table = $("#mr_table").DataTable({
        language: {
            url: "/static/plugins/datatables-1.10.18/i18n/Chinese.lang"
        },
        autoWidth: true,
        scrollX: true,
        scrollCollapse: true,
        ajax: "/plugins/datatable/learn05/data",
        columns: [
            {
                data: null,
                render: function (data, type, row, meta) {
                    return meta.row + 1;
                }
            },
            {
                data: null,
                render: function (data, type, row, meta) {
                    return '<a href="' + row['mr_url'] + '" target="_blank">MR.'+ row['mr_id'] +'</a>';
                }
            },
            {
                data: null,
                render: function (data, type, row, meta) {
                    return row['user_sn'] + '_' + row['user_name']
                }
            },
            {data: 'mr_time'},
            {data: 'status_update_user'},
            {data: 'status_update_time'},
            {data: 'status'},
            {data: 'reason'},
            {
                data: null,
                render: function (data, type, row, meta) {
                    return '<button class="btn btn-xs btn-default edit-button"><i class="fa fa-edit"></i></button>';
                }
            }
        ],
        columnDefs: [
            {
                targets: [7, 8],
                orderable: false
            },
            {
                targets: [8],
                createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
                    $(cell).on('click', 'button.edit-button', function () {
                        var params = {
                            "cell": cell,
                            "cellData": cellData,
                            "rowData": rowData,
                            "rowIndex": rowIndex,
                            "colIndex": colIndex
                        };
                        console.log("params: ", params);

                        var $update_button = "";
                        $update_button = ($(".update-button-box").clone(true)).children();
                        $(cell).html($update_button);

                        $tr = $(cell).parent("tr");
                        var $td_status = $tr.children("td").eq(colIndex-2);
                        var mr_status = $td_status.text();
                        var $mr_status_select = ($(".mr-status-select").clone(true)).children();
                        $mr_status_select.val(mr_status);

                        $td_status.html($mr_status_select);
                    });
                    $(cell).on('click', 'button.save-button', function () {
                        var $dom = "";
                        $dom = $(".edit-button-box").clone(true);
                        $(cell).html($dom.children());
                    });
                    $(cell).on('click', 'button.cancel-button', function () {
                        var $dom = "";
                        $dom = $(".edit-button-box").clone(true);
                        $(cell).html($dom.children());
                    });
                }
            }
        ]
    });



});

</script>
{% endblock %}

